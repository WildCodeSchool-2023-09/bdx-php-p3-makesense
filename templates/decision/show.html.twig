{% extends 'base.html.twig' %}

{% block title %}Decision{% endblock %}


{% block body %}
    <div class="square-container-column-decision">
        <div class="dates-container">
            <div>
            <h2>Dates à retenir</h2>
            </div>
            <div class="date-child
                {% if current_step is defined and current_step == 1 %}
                    date_active
                {% endif %}">
                <p>{{ decision.startingDate ? decision.startingDate|date('Y-m-d') : '' }}</p>
                <p class="decision-starting">Prise de décision commencée</p>
            </div>

            <div class="date-child
                {% if current_step is defined and current_step == 2 %}
                   date_active
                {% endif %}">
                <p>{{ decision.deadlineOpinion ? decision.deadlineOpinion|date('Y-m-d') : '' }} </p>
                <p class="give-opinion">Donner son avis</p>
            </div>

            <div class="date-child
                {% if current_step is defined and current_step == 3 %}
                    date_active
                {% endif %}">
                <p>{{ decision.deadlineDecision ? decision.deadlineDecision|date('Y-m-d') : '' }}</p>
                <p class="decision-taken">Première décision prise</p>
            </div>

            <div class="date-child
                {% if current_step is defined and current_step == 4 %}
                   date_active
                {% endif %}">
                <p>{{ decision.deadlineConflict ? decision.deadlineConflict|date('Y-m-d') : '' }}</p>
                <p class="conflict">Rentrer en conflit:</p>
            </div>
            <div class="date-child
                {% if current_step is defined and current_step == 5 %}
                     date_active
                {% endif %}">
                <p> {{ decision.deadlineFinal ? decision.deadlineFinal|date('Y-m-d') : '' }}</p>
                <p class="decision-ending">Décision définitive</p>
            </div>
        </div>
        <div class="other-container">
           <h1> {{ decision.title }} </h1>
            <div>
                <h2> Descritpion <i class="fa-solid fa-chevron-down"></i></h2>
            </div>
            <div class="decisionP" id="descriptionContent" style="display: none;">
                <p>{{ decision.description|raw }}</p>
            </div>
            <div>
                <h2> Impact sur l’organisation <i class="fa-solid fa-chevron-down"></i></h2>
            </div>
            <div class="decisionP" id="impactContent" style="display: none;">
                <p>{{ decision.impact|raw }}</p>
            </div>

            <div>
                <h2> Situation actuelle <i class="fa-solid fa-chevron-down"></i></h2>
            </div>
            <div class="decisionP" id="situationContent" style="display: none;">
                <p>{{ decision.context|raw }}</p>
            </div>

            <div>
                <h2> Les bénéfices <i class="fa-solid fa-chevron-down"></i></h2>
            </div>
            <div class="decisionP" id="benefitsContent" style="display: none;">
                <p>{{ decision.benefits|raw }}</p>
            </div>

            <div>
                <h2> Les risques <i class="fa-solid fa-chevron-down"></i></h2>
            </div>
            <div class="decisionP" id="risksContent" style="display: none;">
                <p>{{ decision.risk|raw }}</p>
            </div>

            <div>
                <h2> Avis sur la décision <i class="fa-solid fa-chevron-down"></i></h2>
            </div>
            {% for opinion in decision.opinions %}
                <div class="decisionP" id="opinionContent{{ loop.index }}" style="display: none;">
                    <p>{{ opinion.text }}</p>
                    <p>{{ opinion.createdAt ? opinion.createdAt|date('Y-m-d H:i:s') : '' }}</p>
                    {% if opinion.author %}
                        <p> {{ opinion.author.firstname }} {{ opinion.author.lastname }}</p>
                    {% endif %}
                </div>
            {% endfor %}

            {% if current_step == 3 or current_step == 5 %}
                {% if app.user == decision.owner %}
                    <div class="withMarginTop">
                        <a class="button" href="{{ path('new_opinion', {'id': decision.id}) }}"> Donner votre avis </a>
                    </div>
                {% endif %}
            {% else %}
                {% if app.user in decision.users or app.user in decision.userExpert or app.user in decision.groupes %}
                    <div class="withMarginTop">
                        <a class="button" href="{{ path('new_opinion', {'id': decision.id}) }}"> Donner votre avis </a>
                    </div>
                {% endif %}
            {% endif %}
        </div>
        <div class="impacted-person">
        <div>
            <h2> Les personne impactées</h2>
        </div>
        {% for user in users %}
            <li>{{ user.firstname }}</li>
        {% endfor %}
            <div>
                <h2> Les personne experte</h2>
            </div>
            {% for user in userExpert %}
                <li>{{ user.firstname }}</li>
            {% endfor %}
            <div>
                <h2> Les groupes impactés</h2>
            </div>
            {% for group in groupes %}
                <li>{{ group.name }}</li>
            {% endfor %}

            {% if current_step == 3 or current_step == 5 %}
                {% if app.user == decision.owner %}
                    <div class="withMarginTop">
                        <a class="button" href="{{ path('new_opinion', {'id': decision.id}) }}"> Donner votre avis </a>
                    </div>
                {% endif %}
            {% else %}
                {% if app.user in decision.users or app.user in decision.userExpert or app.user in decision.groupes %}
                    <div class="withMarginTop">
                        <a class="button" href="{{ path('new_opinion', {'id': decision.id}) }}"> Donner votre avis </a>
                    </div>
                {% endif %}
            {% endif %}
        </div>
    </div>

    <div>
        <a href="{{ path('app_decision_index') }}">Retour à la liste</a>
        <a href="{{ path('app_decision_edit', {'id': decision.id}) }}">Modifier</a>
        {{ include('decision/_delete_form.html.twig') }}
    </div>


    </div>

    <script>
        function toggleDescription() {
            var descriptionContent = document.getElementById('descriptionContent');
            toggleSection(descriptionContent);
        }

        function toggleImpact() {
            var impactContent = document.getElementById('impactContent');
            toggleSection(impactContent);
        }

        function toggleSituation() {
            var situationContent = document.getElementById('situationContent');
            toggleSection(situationContent);
        }

        function toggleBenefits() {
            var benefitsContent = document.getElementById('benefitsContent');
            toggleSection(benefitsContent);
        }

        function toggleRisks() {
            var risksContent = document.getElementById('risksContent');
            toggleSection(risksContent);
        }

        function toggleOpinion(index) {
            var opinionContent = document.getElementById('opinionContent' + index);
            toggleSection(opinionContent);
        }

        function toggleSection(section) {
            if (section.style.display === 'none' || section.style.display === '') {
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            var descriptionTitles = document.querySelectorAll('.other-container h2');

            descriptionTitles.forEach(function(title) {
                if (title.textContent.includes('Descritpion')) {
                    title.addEventListener('click', toggleDescription);
                } else if (title.textContent.includes('Impact sur l’organisation')) {
                    title.addEventListener('click', toggleImpact);
                } else if (title.textContent.includes('Situation actuelle')) {
                    title.addEventListener('click', toggleSituation);
                } else if (title.textContent.includes('Les bénéfices')) {
                    title.addEventListener('click', toggleBenefits);
                } else if (title.textContent.includes('Les risques')) {
                    title.addEventListener('click', toggleRisks);
                } else if (title.textContent.includes('Avis sur la décision')) {
                    var index = parseInt(title.id.split('_')[1]);
                    title.addEventListener('click', function() { toggleOpinion(index); });
                }
            });
        });
    </script>

{% endblock %}


